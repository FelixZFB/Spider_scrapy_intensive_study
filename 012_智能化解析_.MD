# 1 智能化解析介绍
- 什么是智能化解析？
    - 所谓爬虫的智能化解析，顾名思义就是不再需要我们针对某一些页面来专门写提取规则了，
    - 我们可以利用一些算法来计算出页面特定元素的位置和提取路径。
    - 比如一个页面中的一篇文章，我们可以通过算法计算出来，它的标题应该是什么，正文应该是哪部分区域，发布时间等等。

- 智能化解析任务
    - 其实智能化解析是非常难的一项任务，比如说你给人看一个网页的一篇文章，
    - 人可以迅速找到这篇文章的标题是什么，发布时间是什么，正文是哪一块，或者哪一块是广告位，
    - 哪一块是导航栏。但给机器来识别的话，它面临的是什么？仅仅是一系列的 HTML 代码而已。
    - 那究竟机器是怎么做到智能化提取的呢？其实这里面融合了多方面的信息。

- 智能化解析举例
    - 比如标题。一般它的字号是比较大的，而且长度不长，位置一般都在页面上方，而且大部分情况下它应该和 title 标签里的内容是一致的。
    - 比如正文。它的内容一般是最多的，而且会包含多个段落 p 或者图片 img 标签，另外它的宽度一般可能会占用到页面的三分之二区域，并且密度（字数除以标签数量）会比较大。
    - 比如时间。不同语言的页面可能不同，但时间的格式是有限的，如 2019-02-20 或者 2019/02/20 等等，也有可能是美式的记法，顺序不同，这些也有特定的模式可以识别。
    - 比如广告。它的标签一般可能会带有 ads 这样的字样，另外大多数可能会处于文章底部、页面侧栏，并可能包含一些特定的外链内容。
    - 另外还有一些特点就不再一一赘述了，这其中包含了区块位置、区块大小、区块标签、区块内容、区块疏密度等等多种特征，
    - 另外很多情况下还需要借助于视觉的特征，所以说这里面其实结合了算法计算、视觉处理、自然语言处理等各个方面的内容。
    - 如果能把这些特征综合运用起来，再经过大量的数据训练，是可以得到一个非常不错的效果的。
    
# 2 智能化解析业界进展
- 未来的话，页面也会越来越多，页面的渲染方式也会发生很大的变化，爬虫也会越来越难做，智能化爬虫也将会变得越来越重要。
- 目前工业界，其实已经有落地的算法应用了。经过我的一番调研，发现目前有这么几种算法或者服务对页面的智能化解析做得比较好：
    - Diffbot，国外的一家专门做智能化解析服务的公司，https://www.diffbot.com。
    - Boilerpipe，Java 语言编写的一个页面解析算法，https://github.com/kohlschutter/boilerpipe。
    - Embedly，提供页面解析服务的公司，https://embed.ly/extract。
    - Readability，是一个页面解析算法，但现在官方的服务已经关闭了，https://www.readability.com/。
    - Mercury，Readability 的替代品，https://mercury.postlight.com/。
    - Goose，Java 语音编写的页面解析算法，https://github.com/GravityLabs/goose。
    - 其中，Diffbot 的准确率和召回率都还比较高，Diffbot 也一直致力于这一方面的服务，整个 Diffbot 就是页面解析起家的，现在也一直专注于页面解析服务
    
# 3 Diffbot 简单使用
- Diffbot 页面解析
    - 首先我们需要注册一个账号，它有 15 天的免费试用，注册之后会获得一个 Developer Token，这就是使用 Diffbot 接口服务的凭证。
    - 接下来切换到它的测试页面中，链接为：https://www.diffbot.com/dev/home/，我们来测试一下它的解析效果到底是怎样的。
    - 这里我们选择的测试页面就是上文所述的页面，链接为：https://news.ifeng.com/c/7kQcQG2peWU，API 类型选择 Article API，然后点击 Test Drive 按钮，接下来它就会出现当前页面的解析结果

- Diffbot API
    - Driffbot 提供了多种 API，如 Analyze API、Article API、Disscussion API 等。
    - 下面我们以 Article API 为例来说明一下它的用法，
    - 其官方文档地址为：https://www.diffbot.com/dev/docs/article/，
    - API 调用地址为：https://api.diffbot.com/v3/article
    - 我们可以用 GET 方式来进行请求，其中的 Token 和 URL 都可以以参数形式传递给这个 API，其必备的参数有：
        - token：即 Developer Token；
        - url：即要解析的 URL 链接。
        
    - 另外它还有几个可选参数。
        - fields：用来指定返回哪些字段，默认已经有了一些固定字段，这个参数可以指定还可以额外返回可选字段。
        - paging：针对多页文章，如果将这个参数设置为 false 则可以禁止多页内容拼接。
        - maxTags：可以设置返回的 Tag 最大数量，默认是 10 个。
        - tagConfidence：设置置信度的阈值，超过这个值的 Tag 才会被返回，默认是 0.5。
        - discussion：如果将这个参数设置为 false，那么就不会解析评论内容。
        - timeout：在解析的时候等待的最长时间，默认是 30 秒。
        - callback：为 JSONP 类型的请求而设计的回调。

- Diffbot 使用实例，返回 json 格式数据
```python
import requests, json

url = 'https://api.diffbot.com/v3/article'
params = {
    'token': '77b41f6fbb24496d5113d528306528fa',
    'url': 'https://news.ifeng.com/c/7kQcQG2peWU',
    'fields': 'meta' 
}
response = requests.get(url, params=params)
print(json.dumps(response.json(), indent=2, ensure_ascii=False))

```
- 首先定义了 API 的链接，然后指定了 params 参数，即 GET 请求参数。
- 参数中包含了必选的 token、url 字段，也设置了可选的 fields 字段，
- 其中 fields 为可选的扩展字段 meta 标签，返回 meta 标签里面的内容。


# 4 Diffbot SDK
- Diffbot 还提供了几乎所有语言的 SDK 支持，我们也可以使用 SDK 来实现如上功能，
- 链接为：https://www.diffbot.com/dev/docs/libraries/，
- 如果你使用 Python 的话，可以直接使用 Python 的 SDK 即可，
- Python 的 SDK 链接为：https://github.com/diffbot/diffbot-python-client。
- 这个库并没有发布到 PyPi，需要自己下载并导入使用，另外这个库是使用 Python 2 写的，
- 其实本质上就是调用了 requests 库，如果你感兴趣的话可以看一下。

- 调用示例：
```python
from client import DiffbotClient,DiffbotCrawl

diffbot = DiffbotClient()
token = 'your_token'
url = 'http://shichuan.github.io/javascript-patterns/'
api = 'article'
response = diffbot.request(url, token, api)
```
- 通过这行代码我们就可以通过调用 Article API 来分析我们想要的 URL 链接了，返回结果是类似的。
- 具体的用法你直接看下它的源码注释就一目了然了，还是很清楚的。